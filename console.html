<!DOCTYPE html>
<html>
<head>
<title>InstantMerge-Console</title>
</head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script src="./src/packet/BinaryReader.js"></script>
<body>

  <form>
  Username:<br>
  <input type="text" name="console" id="console" value="/help">
  <br>
  <button type="button" onclick="sendCommand()">Try it</button>
  </form>
  <pre id="log"></pre>
    <script>
      var ws = new WebSocket('wss://instant-merge.herokuapp.com');
      function sendCommand() {
        var data = document.getElementById('console').value;
        ws.send(data);
      }
      function ansi2html(str) {
           var props = {}
             , open = false
           var stylemap =
             { bold: "font-weight"
             , underline: "text-decoration"
             , color: "color"
             , background: "background"
             }
           }
      
      ws.addEventListener("message", function(e) {
        var flags = e[1];    // flags
        var rvLength = (flags & 2 ? 4:0) + (flags & 4 ? 8:0) + (flags & 8 ? 16:0);
        if (e.length < 3 + rvLength) // second validation
        return;

        var reader = new BinaryReader(message);
        reader.skipBytes(2 + rvLength);     // reserved
        var text = null;
        if (this.protocol < 6)
          text = reader.readStringZeroUnicode();
        else
          text = reader.readStringZeroUtf8();
        console.log("get "+e.data);
        var msg = e.data;
        if (msg == ">") msg='';
        var $log = document.getElementById('log');
        log.innerHTML = log.innerHTML + '\n' + ansi2html(msg);
        window.scrollTo(0,document.body.scrollHeight);
      });
      </script>
</form> 

</body>
</html>
